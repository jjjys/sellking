<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Building Register Request</title>
</head>
<body>
    <h1>Request Building Register</h1>
    <form id="registerForm">
        <label for="address">Address:</label>
        <input type="text" id="address" name="address" value="경기도 안양시 만안구 삼봉로 61"><br><br>
        <label for="dong">Dong:</label>
        <input type="text" id="dong" name="dong" value="103"><br><br>
        <label for="num">Ho:</label>
        <input type="text" id="num" name="num" value="1502"><br><br>
        <label for="output_format">Output Format:</label>
        <select id="output_format" name="output_format">
            <option value="html">HTML</option>
            <option value="pdf">PDF</option>
        </select><br><br>
        <button type="submit">Submit</button>
    </form>
    <h2>Response</h2>
    <iframe id="response" style="width:100%;height:500px;"></iframe>

    <script>
        document.getElementById("registerForm").addEventListener("submit", async (event) => {
            event.preventDefault();
            const formData = {
                address: document.getElementById("address").value,
                dong: document.getElementById("dong").value,
                num: document.getElementById("num").value,
                output_format: document.getElementById("output_format").value
            };
            try {
                const response = await fetch("http://127.0.0.1:8000/get_building_register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(formData)
                });
                if (response.ok) {
                    if (formData.output_format === "html") {
                        const htmlContent = await response.text();
                        const iframe = document.getElementById("response");
                        iframe.contentDocument.open();
                        iframe.contentDocument.write(htmlContent);
                        iframe.contentDocument.close();
                    } else {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        window.open(url, "_blank");
                    }
                } else {
                    const error = await response.json();
                    document.getElementById("response").contentDocument.open();
                    document.getElementById("response").contentDocument.write(`<pre>Error: ${JSON.stringify(error, null, 2)}</pre>`);
                    document.getElementById("response").contentDocument.close();
                }
            } catch (error) {
                document.getElementById("response").contentDocument.open();
                document.getElementById("response").contentDocument.write(`<pre>Error: ${error.message}</pre>`);
                document.getElementById("response").contentDocument.close();
            }
        });
    </script>
</body>
</html>